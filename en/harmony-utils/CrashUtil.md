# harmony-utils CrashUtil, exception-related tool class

## Introduction and description of harmony-utils

------
[harmony-utils](https://ohpm.openharmony.cn/#/cn/detail/@pura%2Fharmony-utils)A HarmonyOS tool library with rich features and extremely easy to use, with the help of many practical tools, is committed to helping developers quickly build Hongmeng applications. Its encapsulated tools cover APP, device, screen, authorization, notification, inter-thread communication, pop-up frames, toast, biometric authentication, user preferences, taking photos, albums, scanning codes, files, logs, exception capture, characters, strings, numbers, collections, dates, random, base64, encryption, decryption, JSON and other functions, which can meet various development needs.
[picker_utils](https://ohpm.openharmony.cn/#/cn/detail/@pura%2Fpicker_utils)It is a sub-store split by harmony-utils, including PickerUtil, PhotoHelper, and ScanUtil.

Download and install
`ohpm i @pura/harmony-utils`  
`ohpm i @pura/picker_utils`

 ```
  //å…¨å±€åˆå§‹åŒ–æ–¹æ³•ï¼Œåœ¨UIAbilityçš„onCreateæ–¹æ³•ä¸­åˆå§‹åŒ– AppUtil.init()
  onCreate(want: Want, launchParam: AbilityConstant.LaunchParam): void {
    AppUtil.init(this.context);
  }
 ```

## API methods and usage

------

##### onHandled registers an error observer (this method is recommended to be called in Ability). After registration, you can capture the js crash generated by the application, and the process will not exit when the application crashes. Write exception information to local file

```
CrashUtil.onHandled((exceptionInfo)=>{
  LogUtil.error(JSON.stringify(exceptionInfo, null, 2));
});
```

##### onDestroy Log out of error observer

```
CrashUtil.onDestroy(); //æ³¨é”€é”™è¯¯è§‚æµ‹å™¨
ToastUtil.showToast("æ³¨é”€è¯¯è§‚æµ‹å™¨,æˆåŠŸï¼");
```

##### isHandled determines whether the error observer exists

```
let isHandled = CrashUtil.isHandled();
ToastUtil.showToast(`è¯¯è§‚æµ‹å™¨æ˜¯å¦å­˜åœ¨ï¼š${isHandled}`);
```

##### getFilePath Gets the log file path (used to read exception files and export exception files)

```
let path = CrashUtil.getFilePath();
LogUtil.error(`å¼‚å¸¸æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼š${path}`);
```

##### access determines whether the log file exists

```
let access = CrashUtil.access();
ToastUtil.showToast(`æ—¥å¿—æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š${access}`);
```

##### delete delete log file

```
CrashUtil.delete();
ToastUtil.showToast(`æ—¥å¿—æ–‡ä»¶åˆ é™¤æˆåŠŸï¼`);
```

##### getExceptionJson gets the JSON string of the exception log

```
if (CrashUtil.access()) {
  let jsonStr = await CrashUtil.getExceptionJson(); //è¯»å–JSON
  Utils.showSheetText(jsonStr);
} else {
  ToastUtil.showToast("æš‚æ— æ—¥å¿—æ–‡ä»¶");
}
```

##### getExceptionList gets the collection of exception logs

```
if (CrashUtil.access()) {
  let list = await CrashUtil.getExceptionList();
  DialogHelper.showToast(`å¼‚å¸¸ä¸ªæ•°ï¼š${list.length}`);
} else {
  ToastUtil.showToast("æš‚æ— æ—¥å¿—æ–‡ä»¶");
}
```

##### enableAppRecovery Enable the application recovery function and fill in the parameters in order. After this interface is called, the first Ability supports recovery when the application starts from the initiator

```
CrashUtil.enableAppRecovery();
```

##### restartApp Restart the APP and pull up the first Ability when the application starts. It can be used with the errorManager-related interface

```
CrashUtil.restartApp();
```

##### saveAppState Save the current App status or actively save the state of Ability. This state will be used the next time you resume startup. Can be used with errorManager related interface

```
CrashUtil.saveAppState(this.context);
```

##### setRestartWant Set the next time you restore the Ability in the scene that actively pulls up. The Ability must be the UIAbility under the current package

```
let want: Want = {
  bundleName: 'com.harmony.utils',
  abilityName: 'EntryAbility'
};
CrashUtil.setRestartWant(want);
```

## Creation is not easy, please give Elder Tong a thumbs up ğŸ‘

------
[https://github.com/787107497/harmony-utils](https://github.com/787107497/harmony-utils)   
[https://gitee.com/tongyuyan/harmony-utils](https://gitee.com/tongyuyan/harmony-utils)   
[OpenHarmonyä¸‰æ–¹åº“](https://ohpm.openharmony.cn/#/cn/detail/@pura%2Fharmony-utils)   
[ç«¥é•¿è€CSDNåšå®¢](https://blog.csdn.net/qq_32922545)   
   



